var total_index = 0;
var x =0;

//Creates the 4 initial rows + bottom 'TOTAL' row with format.
//This number can be changed to however many starting rows are wanted
if(form.load){
  Date[4].visible = false;
  TableItem[4].enabled = false;
  TableItem[4].deletable = false;
}

//If an item is added, check which position and adjust location of TOTAL row
if(TableRepeat.itemAdded){
  var new_index = TableRepeat.itemIndex;

  //Make sure that all rows above TOTAL row can be accessed no matter where new row was inserted
  for(var a = 0; a < Department.value.length-1; a++){
    TableItem[a].deletable = true;
    TableItem[a].enabled = true;
    Date[a].visible = true;
    total_index++;
  }
  
  Charge[total_index].value = null;
  total_index--;
  
  //If user tried to insert new row after TOTAL, move TOTAL down to bottom row
  if(new_index > total_index){
    Note[new_index].value = 'TOTAL';
    Charge[total_index].value=null;
    TableItem[new_index].enabled = false;
    TableItem[new_index].deletable = false;
    Date[new_index].visible = false;
    new_index--;
    Charge[new_index].value = null;
    Note[new_index].value = null;
    Date[new_index].visible = true;
  }
}

var ch = 0;
var count = 0;

//Grab all charge values to compute the total
for(var i = 0; i < Department.value.length-1; i++){
    if(Department[i].value.length > 0){      
      if((ch = Charge[i].value) > 0){
      x += ch;
      }
    }
  count++;
}

//Make sure there is at least 1 value to store in TOTAL
if(count > 0){
    Charge[count].value = x;
}
count = 0;
x = 0;

if(TableRepeat.itemRemoved){
  var x = 0;
}